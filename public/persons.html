<html>
    <head>
        <meta charset="UTF-8">
		<style>
			.wrapper{
				width:800px;
				margin:auto;
			}
        	.form{
				float:left;
				width:350px;
				height:150px;
			}
			.combo_container{
				float:right;
				width:350px;
				height:150px;
			}
			.grid{
				float:left;
				width:800px;
				height:300px;
			}
        
        </style>
        <link  rel="stylesheet" type="text/css" href="wD/codebase4.2_std/dhtmlx.css" />
	
        <script type="text/javascript" src="wD/codebase4.2_std/dhtmlx.js"></script>
		<script type="text/javascript" src="dhx/dhx.js"></script>
		<script>
	   "company_id,company_branch_id,group_id,first_name,last_name,email,username,password,title,status".split(",")
	   		.forEach( function (name, index, array)
			{
					console.log(  ",{ type : 'input', name :'"+name+"', label: '"+name+"'}"  );
					
			});
	    var settings = {
            conf_form: {
                "template": 
				[{
					type: "settings",
					position: "label-left",
					labelWidth: 120,
					inputWidth: 160
				}
				
				
				,{ type : 'input', name :'company_id', label: 'company_id'}
				,{ type : 'input', name :'company_branch_id', label: 'company_branch_id'}
				,{ type : 'input', name :'group_id', label: 'group_id'}
				,{ type : 'input', name :'first_name', label: 'first_name'}
				,{ type : 'input', name :'last_name', label: 'last_name'}
				,{ type : 'input', name :'email', label: 'email'}
				,{ type : 'input', name :'username', label: 'username'}
				,{ type : 'input', name :'password', label: 'password'}
				,{ type : 'input', name :'title', label: 'title'}
				,{ type : 'input', name :'status', label: 'status'}
				
				, {
					type: "button",
					value: "save existing record",
					name: "x_special_button_update" // x_special_button_update id automatically recognized when binding a form to a dataset
				}, {
					type: "button",
					value: "save as new",
					name: "x_special_button_save" // x_special_button_save id automatically recognized when binding a form to a dataset
				}, {
					type: "button",
					value: "delete current record",
					name: "x_special_button_delete" // x_special_button_delete id automatically recognized when binding a form to a dataset
				}

			]} // end form settings
        
            ,// grid settings
            conf_grid_persons: {
                 "headers": "company_id,company_branch_id,group_id,first_name,last_name,email,username,password,title,status",
                "ids": "company_id,company_branch_id,group_id,first_name,last_name,email,username,password,title,status",
                "widths": "*",
                "colaligns": "left,left,left,left,left,left,left,left,left,left",
                "coltypes": "ro,ro,ro,ro,ro,ro,ro,ro,ro,ro",
                "colsorting": "int,int,str,str,str,str,str,str,str,str"
            }// end grid settings
        
        }; // end settings
        
        // global vars
        var form, grid;
        
        // start application when DOM is loaded
        window.onload = function (e) {
        
            /* BEGIN RENDERIZE THE APPLICATION SCREEN */
			
			$dhx.showDirections("rendering application screen ");
			
			// set global dhtmlx img path
            window.dhx_globalImgPath = "wD/codebase4.2_std/imgs/";
        
            // create dhtmlx form
            form = new dhtmlXForm("form", settings.conf_form.template);
			// lets comment the following code and use the special bound buttons: x_special_button_save, x_special_button_update and x_special_button_delete
			/*form.attachEvent("onButtonClick", function(name){
				if( name == "save" )
				 	form.save();   // call only when bound to a dataset to be able to save trhough REST API
				else if( name == "update" )
					form.update();  // call only when bound to a dataset
				else if( name == "delete" )
					form.erase();  // call only when bound to a dataset
			 });*/

        
            // begin grid code
            // create dhtmlx grid
            grid = new dhtmlXGridObject('grid');
            // configure dhtmlx grid
            grid.setHeader(settings.conf_grid_persons.headers);
            grid.setColumnIds(settings.conf_grid_persons.ids);
            grid.setInitWidths(settings.conf_grid_persons.widths);
            grid.setColAlign(settings.conf_grid_persons.colaligns);
            grid.setColTypes(settings.conf_grid_persons.coltypes);
            grid.setColSorting(settings.conf_grid_persons.colsorting);
            grid.init();
            grid.attachEvent("onRowSelect", function(id, ind) {
                // set cursor position to the selected grid row
                $dhx.jDBd.setCursor({
                    data_set_name: "persons",
                    position: id
                });
            });
            // end grid code
			/* END RENDERIZE THE APPLICATION SCREEN */
			$dhx.hideDirections();
			
			var id_of_the_contact_which_is_using_the_application = 1397;
			if( $dhx.$_GET("ContactId") !== null)
			{
				id_of_the_contact_which_is_using_the_application = $dhx.$_GET("ContactId");
			}
			
			var private_key  = navigator.userAgent;
			var user_credential = $dhx.crypt.base64_encode( 
							$dhx.crypt.base64_encode( 'eduardo@web2solutions.com.br' ) + 
							":" + 
							$dhx.crypt.SHA2( private_key + "_" + $dhx.crypt.SHA2('jepa21') ) 
			);
			$dhx.cookie.set( "apitemp", user_credential, $dhx.REST.API.date_expiration / 1000 );
			
			
            // logs into REST API
            $dhx.REST.API.authorize({
                
                agency_id: 25,
                onSuccess: function(request) {
					
					$dhx.hideDirections();
					$dhx.showDirections("creating dataset ");
        			
					// create main the dataset. 
							$dhx.jDBd.create({
								// For best conventions, use the same name of the table on the database
								data_set_name: "persons"
									// primary key name of the table
									,
								primary_key: "person_id"
									// provide an static array containing the data for filling the dataset
									//,data : []
									// should overwrite this dataset on the memory if it already exists?
									,
								overwrite: true
									// provide API informations for fetching data from server when creating the dataset instead providing an static array
									,
								api_service: {
									end_point : "/persons" // default API end point, use it when all end points are equal
									,collection_name: "persons" // API data collection name -> MANDATORY
									,api_payload: "columns=" + settings.conf_grid_persons.ids + ",person_id" // not mandatory
								} // not mandatory default false
								,
								onSuccess: function() {
		
				
									// sync grid
									$dhx.jDBd.sync({
										data_set_name: "persons" // mandatory
											,
										component: grid // mandatory
											,
										component_id: "grid" // mandatory
											,
										onSuccess: function() {
											// if grid was successful synced, then
				
											// select the first record on the grid
											grid.selectRow(0, true, false, false);
				
											// bind form
											$dhx.jDBd.bind({
												data_set_name: "persons" // mandatory
												,component: form // mandatory
												,component_id: "form" // mandatory
											});
											
											$dhx.hideDirections();
										},
										onFail: function(reason) {
											console.log(reason);
											$dhx.hideDirections();
										}
									});
								}
							}); // end create dataset ContactEducation
	
					
                },
                onFail: function(request) {
        
                }
            });
            /**/
			
			
			
			
        }
		
			
        </script>
	</head>
<body>
	<div class="wrapper">
    	<div class="form" id="form"></div>
        <div class="grid" id="grid"></div>
    </div>
</body>
</html>
